<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∫–∞—Ä—Ç—ã</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background: #333;
      color: white;
      padding: 10px 20px;
      font-size: 20px;
    }
    main {
      display: flex;
      flex: 1;
    }
    #controls {
      width: 40%;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid #ccc;
    }
    #map-preview {
      flex: 1;
      background: #ddd;
      position: relative;
      overflow: hidden;
      cursor: grab;
    }
    #map-wrapper {
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: 0 0;
    }
    #map-image {
      display: block;
      width: 100%;
      height: auto;
      pointer-events: none;
    }
    .preview-marker {
      position: absolute;
      width: 20px;
      height: 20px;
      background: red;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      cursor: grab;
    }
    .preview-marker:active {
      cursor: grabbing;
    }
    .preview-tooltip {
      position: absolute;
      background: white;
      border: 1px solid #aaa;
      padding: 6px;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 9999;
      max-width: 200px;
      pointer-events: none;
    }
    .preview-tooltip img {
      width: 100%;
      height: auto;
      margin-bottom: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #f0f0f0;
    }
    button {
      margin-right: 6px;
    }
    form input, form textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 6px;
      font-size: 14px;
    }
    #login-screen {
      position: fixed;
      inset: 0;
      background: #000000cc;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 10000;
    }
    #login-screen input {
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
    }
    #map-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    #map-controls button {
      background: white;
      border: 1px solid #ccc;
      padding: 4px 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="login-screen">
    <h2>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</h2>
    <input type="password" id="admin-password" placeholder="–ü–∞—Ä–æ–ª—å" onkeydown="if(event.key==='Enter') checkPassword()">
    <button onclick="checkPassword()">–í–æ–π—Ç–∏</button>
  </div>

  <header>üó∫ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ</header>
  <main>
    <section id="controls">
      <h2>–î–æ–±–∞–≤–∏—Ç—å / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫—É</h2>
      <form id="point-form">
        <input type="hidden" id="edit-index">
        <label>X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞:<input type="number" id="x"></label>
        <label>Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞:<input type="number" id="y"></label>
        <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É:<input type="text" id="image"></label>
        <label>–û–ø–∏—Å–∞–Ω–∏–µ:<textarea id="text"></textarea></label>
        <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" onclick="resetForm()">‚Ü© –û—á–∏—Å—Ç–∏—Ç—å</button>
      </form>

      <h2>–°–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫</h2>
      <table id="points-table">
        <thead>
          <tr><th>#</th><th>X</th><th>Y</th><th>–§–æ—Ç–æ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <button onclick="saveJSON()">üíæ –û–±–Ω–æ–≤–∏—Ç—å points.json</button>
      <input type="file" accept="application/json" onchange="uploadJSON(this)">
    </section>
    <section id="map-preview">
      <div id="map-controls">
        <button onclick="zoomIn()">‚ûï –£–≤–µ–ª–∏—á–∏—Ç—å</button>
        <button onclick="zoomOut()">‚ûñ –£–º–µ–Ω—å—à–∏—Ç—å</button>
        <button onclick="resetZoom()">üîÑ –°–±—Ä–æ—Å –º–∞—Å—à—Ç–∞–±–∞</button>
      </div>
      <div id="map-wrapper">
        <img id="map-image" src="tiles/tile_0_0.jpg" alt="–ö–∞—Ä—Ç–∞">
      </div>
      <div id="hover-preview" class="preview-tooltip" style="display:none;"></div>
    </section>
  </main>

  <script>
    const tooltip = document.getElementById('hover-preview');

    function showPreviewTooltip(marker, point) {
      tooltip.innerHTML = `<img src="${point.image}"><div>${point.text}</div>`;
      tooltip.style.left = (marker.offsetLeft + 25) + 'px';
      tooltip.style.top = (marker.offsetTop - 10) + 'px';
      tooltip.style.display = 'block';
    }

    function hidePreviewTooltip() {
      tooltip.style.display = 'none';
    }

    // –≤–Ω—É—Ç—Ä–∏ renderTable() –¥–æ–±–∞–≤–∏–º
    // marker.addEventListener('mouseenter', () => showPreviewTooltip(marker, p));
    // marker.addEventListener('mouseleave', hidePreviewTooltip);
  </script>
</body>
</html>
